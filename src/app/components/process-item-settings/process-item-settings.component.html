<div *ngIf="visible" class="settings-modal">




  <div class="form-wrapper">

    <div>

      <mat-form-field  class="process-item-selector " appearance="outline">
        <mat-label></mat-label>
        <mat-select [(value)]="processItem">
          <mat-option *ngFor="let processItem of processItems" [value]="processItem">
            {{processItem.text}} - {{processItem.id}}
          </mat-option>
        </mat-select>
      </mat-form-field>

    </div>

    <!-- <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <formly-form [form]="form" [fields]="fields2" [model]="model2"></formly-form>
      <button type="submit" class="btn btn-default">Submit</button>
    </form> -->

    <div fxLayout="row" fxLayoutAlign="end none">
      <i (click)="close()" class="fas fa-times close-button clickable"></i>
    </div>
    <div class="step-definition-title">
      Step definitions <i class="fas fa-question-circle clickable"></i>
    </div>
    <div class="step-title">
      for {{processItem.text}}
    </div>


    <ng-container *ngIf="processItem.constructor.name== 'StepItem'">

      <div class="section clickable">

        <button mat-button #settingNotVisible color="primary">
          <div class="section-name">
            <i class="fas fa-angle-double-down"></i> Responsible
          </div>
        </button>

      </div>

      <div class="section clickable" (click)="swapStepFormDesignerVisible()">

        <button mat-button #settingNotVisible color="primary">
          <div class="section-name">
            <i *ngIf="isStepFormDesignerVisible" class="fas fa-angle-double-up"></i> <i
              *ngIf="!isStepFormDesignerVisible" class="fas fa-angle-double-down"></i> Form designer
          </div>
        </button>

      </div>
      <div *ngIf="isStepFormDesignerVisible" class="form-designer-wrapper">

        <div>

          <div class="form-designer-empty-content" *ngIf="stepItem.fields.length == 0">
            This step doesn't contain any field. <button mat-raised-button color="accent" (click)="addField()">
              <i class="fas fa-plus"></i> Add a new field?
            </button>
          </div>

          <form #fieldsForm="ngForm">

            <!-- bu ngform'u koy
ngModel kullan
name attribute'unu doldur

alakasiz ama
trackBy diye onemli bir
sey var *ngFor kullanirken
-->

            <div class="field-form" fxLayout="column" *ngFor="let field of stepItem.fields; let i=index">

              <div fxLayout="row">

                <div class="field-number" fxLayout="row" fxLayoutAlign="center center">
                  {{i+1}}
                </div>

                <mat-form-field appearance="outline">
                  <mat-label>Field Name</mat-label>
                  <input [(ngModel)]="field.name" name="name-{{field.id}}" matInput #input>
                </mat-form-field>
                <mat-form-field appearance="outline">
                  <mat-label>Field Type</mat-label>
                  <mat-select [(ngModel)]="field.fieldType" name="fieldType-{{field.id}}">
                    <mat-option [value]="null"></mat-option>
                    <mat-option *ngFor="let fieldType of fieldTypes" [value]="fieldType">
                      {{fieldType.name}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <div class="required-wrapper">
                  <mat-checkbox color="primary" [(ngModel)]="field.isRequired" name="isRequired-{{field.id}}">Required?
                  </mat-checkbox>
                </div>

              </div>

              <div fxLayout="row">

                <div class="setting-wrapper clickable" (click)="swapSettingVisible(field)">

                  <div *ngIf="field.visualState.settingsVisible; else settingNotVisible">

                    <button mat-button #settingNotVisible color="primary">
                      <i class="fas fa-angle-double-up"></i> Hide settings
                    </button>

                  </div>
                  <ng-template #settingNotVisible>

                    <button mat-button #settingNotVisible color="primary">
                      <i class="fas fa-angle-double-down"></i>
                      More field settings
                    </button>

                  </ng-template>
                </div>
              </div>

              <div *ngIf="field.visualState.settingsVisible" class="detailed-settings">

                <ng-container *ngIf="field.fieldType">

                  <div *ngIf="field.fieldType.code == 'numeric'">

                    <!-- numeric settings, min, max, decimal? -->
                    <div fxLayout="row" class="detailed-settings-item">
                      <mat-checkbox class="detailed-settings-item-checkbox" color="primary"
                        [(ngModel)]="field.numericFieldSettings.hasMinValueRestriction"
                        name="hasMinValueRestriction-{{field.id}}">Set Minimum Value?
                      </mat-checkbox>

                      <mat-form-field appearance="outline" *ngIf="field.numericFieldSettings.hasMinValueRestriction">
                        <mat-label>Minimum value</mat-label>
                        <input [(ngModel)]="field.numericFieldSettings.minValue" name="minValue-{{field.id}}" matInput
                          type="number">
                      </mat-form-field>
                    </div>

                    <div fxLayout="row" class="detailed-settings-item">
                      <mat-checkbox class="detailed-settings-item-checkbox" color="primary"
                        [(ngModel)]="field.numericFieldSettings.hasMaxValueRestriction"
                        name="hasMaxValueRestriction-{{field.id}}">Set Maximum Value?
                      </mat-checkbox>

                      <mat-form-field appearance="outline" *ngIf="field.numericFieldSettings.hasMaxValueRestriction">
                        <mat-label>Maximum value</mat-label>
                        <input [(ngModel)]="field.numericFieldSettings.maxValue" name="maxValue-{{field.id}}" matInput
                          type="number">
                      </mat-form-field>
                    </div>

                  </div>
                  <div *ngIf="field.fieldType.code === 'text'">
                    text settings: multiline, max character, min character
                  </div>

                </ng-container>

              </div>

            </div>

          </form>

        </div>

        <div *ngIf="stepItem.fields.length > 0" class="new-field-wrapper">
          <button mat-raised-button color="accent" (click)="addField()">
            <i class="fas fa-plus"></i> New Field
          </button>
        </div>

        <div *ngIf="stepItem.fields.length > 0" class="save-form-designer-wrapper">
          <button mat-raised-button color="primary">
            Save form definition
          </button>
        </div>


      </div>

      <div class="section clickable">
        <button mat-button #settingNotVisible color="primary">
          <div class="section-name">
            <i class="fas fa-angle-double-down"></i> Actions
          </div>
        </button>
      </div>

      <div class="section clickable">
        <button mat-button #settingNotVisible color="primary">
          <div class="section-name">
            <i class="fas fa-angle-double-down"></i> Description & help content
          </div>
        </button>
      </div>
      <!-- notifications -->

    </ng-container>

  </div>
</div>
